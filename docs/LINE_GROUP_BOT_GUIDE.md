# üè† LINE Group Bot Setup Guide - ‡∏ö‡∏≠‡∏ó‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß

## üìå Concept: ‡∏ö‡∏≠‡∏ó‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° vs ‡∏ö‡∏≠‡∏ó‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß

### ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ‡∏Ç‡∏≠‡∏á‡∏ö‡∏≠‡∏ó‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°
‚úÖ **‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏´‡πá‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô** - ‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏≤‡∏ô‡πÄ‡∏´‡πá‡∏ô real-time ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡∏ï‡∏≠‡∏ö
‚úÖ **‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏£‡πà‡∏ß‡∏°** - ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô/‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à
‚úÖ **‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™** - ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏ß‡πà‡∏≤‡πÅ‡∏°‡πà/‡∏û‡πà‡∏≠‡∏Ñ‡∏∏‡∏¢‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡∏±‡∏ö‡∏ö‡∏≠‡∏ó
‚úÖ **‡∏á‡πà‡∏≤‡∏¢** - ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÑ‡∏õ‡∏°‡∏≤

### ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢‡∏Ç‡∏≠‡∏á‡∏ö‡∏≠‡∏ó‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°
‚ùå **Privacy** - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÄ‡∏´‡πá‡∏ô‡∏´‡∏°‡∏î
‚ùå **Spam** - ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏≤‡∏à‡∏£‡∏ö‡∏Å‡∏ß‡∏ô‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô
‚ùå **‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô** - ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏¢‡∏Å context ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô

---

## Step 1: Enable Group & Multi-person Chat

### 1.1 LINE Developers Console Settings
```
1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Messaging API tab
2. ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ "Features"
3. ‡πÄ‡∏õ‡∏¥‡∏î Settings:
   ‚úÖ Allow bot to join group chats
   ‚úÖ Allow bot to join multi-person chats
```

### 1.2 LINE OA Manager Settings
```
1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà https://manager.line.biz/
2. Settings > Response settings
3. ‡∏õ‡∏¥‡∏î:
   ‚ùå Greeting message (‡πÉ‡∏ä‡πâ custom)
   ‚ùå Auto-response (‡πÉ‡∏ä‡πâ webhook)
4. ‡πÄ‡∏õ‡∏¥‡∏î:
   ‚úÖ Webhooks
```

---

## Step 2: Group Event Types ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á Handle

### 2.1 ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ö‡∏≠‡∏ó‡∏ñ‡∏π‡∏Å‡πÄ‡∏ä‡∏¥‡∏ç‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°
```javascript
// Event type: 'join'
{
  type: 'join',
  source: {
    type: 'group',
    groupId: 'C1234567890abcdef'  // Save this!
  }
}

// Response: ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢
async handleJoinGroup(event) {
  const groupId = event.source.groupId;
  
  await client.pushMessage(groupId, {
    type: 'text',
    text: `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡πà‡∏∞! üëã
    
‡∏ú‡∏°/‡∏î‡∏¥‡∏â‡∏±‡∏ô‡∏Ñ‡∏∑‡∏≠ Health Buddy ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
‡∏à‡∏∞‡∏Ñ‡∏≠‡∏¢‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤ ‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡πà‡∏∞

üîß ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô:
1. ‡∏û‡∏¥‡∏°‡∏û‡πå "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•
3. ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏¢‡∏≤

‡∏û‡∏¥‡∏°‡∏û‡πå "‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠" ‡∏î‡∏π‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î`
  });
  
  // Save group to database
  await saveGroup(groupId);
}
```

### 2.2 Message ‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°
```javascript
// Event type: 'message' with source.type = 'group'
{
  type: 'message',
  source: {
    type: 'group',
    groupId: 'Cxxxxx',
    userId: 'Uxxxxx'  // ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå
  },
  message: {
    type: 'text',
    text: '‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤‡πÅ‡∏•‡πâ‡∏ß'
  }
}
```

---

## Step 3: ‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡πÅ‡∏¢‡∏∞ Context ‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°

### 3.1 ‡πÉ‡∏ä‡πâ Mention (@) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô
```javascript
// ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå: "@‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏°‡πà ‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤‡πÅ‡∏•‡πâ‡∏ß"
async handleGroupMessage(event) {
  const text = event.message.text;
  const userId = event.source.userId;
  const groupId = event.source.groupId;
  
  // Check if message mentions someone
  if (text.includes('@')) {
    const mentioned = extractMention(text); // @‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏°‡πà
    const action = extractAction(text);     // ‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤‡πÅ‡∏•‡πâ‡∏ß
    
    await logMedicationForPerson(mentioned, action);
    await replyMessage(event.replyToken, 
      `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞: ${mentioned} ${action} ‚úÖ`
    );
  }
}
```

### 3.2 ‡πÉ‡∏ä‡πâ Quick Reply ‡πÅ‡∏ö‡∏ö‡∏°‡∏µ Data
```javascript
// ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏¢‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô
const reminderWithIdentity = {
  type: 'text',
  text: 'üîî ‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤‡πÄ‡∏ä‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞',
  quickReply: {
    items: [
      {
        type: 'action',
        action: {
          type: 'postback',
          label: '‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏°‡πà‡∏ó‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß',
          data: 'action=med_taken&user=mom&time=morning',
          displayText: '‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏°‡πà‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤‡πÄ‡∏ä‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß'
        }
      },
      {
        type: 'action',
        action: {
          type: 'postback',
          label: '‡∏Ñ‡∏∏‡∏ì‡∏û‡πà‡∏≠‡∏ó‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß',
          data: 'action=med_taken&user=dad&time=morning',
          displayText: '‡∏Ñ‡∏∏‡∏ì‡∏û‡πà‡∏≠‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤‡πÄ‡∏ä‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß'
        }
      }
    ]
  }
};
```

---

## Step 4: Database Schema ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Group

### 4.1 Groups Table
```sql
CREATE TABLE groups (
  id UUID PRIMARY KEY,
  line_group_id VARCHAR(255) UNIQUE,
  group_name VARCHAR(255),
  created_at TIMESTAMP,
  active BOOLEAN DEFAULT true
);
```

### 4.2 Group Members Table
```sql
CREATE TABLE group_members (
  id UUID PRIMARY KEY,
  group_id UUID REFERENCES groups(id),
  user_id UUID REFERENCES users(id),
  line_user_id VARCHAR(255),
  role VARCHAR(50), -- 'elderly', 'caregiver'
  nickname VARCHAR(100), -- '‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏°‡πà', '‡∏Ñ‡∏∏‡∏ì‡∏û‡πà‡∏≠'
  primary_patient BOOLEAN DEFAULT false
);
```

### 4.3 Group Settings
```sql
CREATE TABLE group_settings (
  id UUID PRIMARY KEY,
  group_id UUID REFERENCES groups(id),
  reminder_times JSONB, -- ["08:00", "12:00", "18:00"]
  report_time TIME DEFAULT '22:00',
  alert_threshold INTEGER DEFAULT 18, -- hours
  notify_all BOOLEAN DEFAULT true
);
```

---

## Step 5: Smart Features ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°

### 5.1 Morning Greeting ‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô
```javascript
// Cron job: 07:00
async function morningGreeting(groupId) {
  const members = await getElderlyInGroup(groupId);
  
  let greeting = '‚òÄÔ∏è ‡∏≠‡∏£‡∏∏‡∏ì‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏¥‡πå‡∏Ñ‡πà‡∏∞\n\n';
  members.forEach(member => {
    greeting += `${member.nickname} - ‡∏¢‡∏≤‡πÄ‡∏ä‡πâ‡∏≤ ${member.morning_med_time}\n`;
  });
  
  await client.pushMessage(groupId, {
    type: 'text',
    text: greeting + '\n‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ô‡∏∞‡∏Ñ‡∏∞ üíö'
  });
}
```

### 5.2 Daily Summary ‡πÅ‡∏ö‡∏ö‡∏£‡∏ß‡∏°
```javascript
// 22:00 - ‡∏™‡πà‡∏ß‡∏ô Summary ‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°
async function sendGroupDailyReport(groupId) {
  const members = await getElderlyInGroup(groupId);
  const reports = await generateReportsForAll(members);
  
  // Flex Message with carousel
  const flexMessage = {
    type: 'flex',
    altText: '‡∏™‡∏£‡∏∏‡∏õ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô',
    contents: {
      type: 'carousel',
      contents: reports.map(report => createReportBubble(report))
    }
  };
  
  await client.pushMessage(groupId, flexMessage);
}
```

### 5.3 Emergency Alert ‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°
```javascript
async function sendGroupEmergencyAlert(groupId, patient, issue) {
  // Mention everyone
  const message = {
    type: 'text',
    text: `‚ö†Ô∏è ‡∏î‡πà‡∏ß‡∏ô! ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠

${patient.nickname} ${issue}
- ‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡∏°‡∏≤: ${patient.hours_no_response} ‡∏ä‡∏°.
- ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${patient.last_contact}

‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÇ‡∏ó‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏î‡πà‡∏ß‡∏ô ‚òéÔ∏è`,
    
    // ‡πÄ‡∏û‡∏¥‡πà‡∏° Quick Action
    quickReply: {
      items: [
        {
          type: 'action',
          action: {
            type: 'uri',
            label: 'üìû ‡πÇ‡∏ó‡∏£‡∏´‡∏≤',
            uri: `tel:${patient.phone}`
          }
        },
        {
          type: 'action',
          action: {
            type: 'message',
            label: '‚úÖ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠',
            text: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏°‡πà'
          }
        }
      ]
    }
  };
  
  await client.pushMessage(groupId, message);
}
```

---

## Step 6: Commands ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°

### 6.1 Command List
```javascript
const GROUP_COMMANDS = {
  '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô': handleRegistration,
  '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏': addElderly,
  '‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤': setReminders,
  '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô': sendInstantReport,
  '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞': checkStatus,
  '‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠': showHelp,
  '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô': pauseReminders
};

// Handle commands
if (text.startsWith('/') || GROUP_COMMANDS[text]) {
  const command = text.replace('/', '');
  await GROUP_COMMANDS[command](event);
}
```

### 6.2 Help Menu
```javascript
const helpMessage = `üìñ ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:

üë§ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å:
‚Ä¢ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
‚Ä¢ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏π‡πÅ‡∏•

‚è∞ ‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:
‚Ä¢ ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤ - ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏¢‡∏≤
‚Ä¢ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô - ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß

üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô:
‚Ä¢ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô - ‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
‚Ä¢ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ - ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡πÅ‡∏•‡πâ‡∏ß‡∏ö‡πâ‡∏≤‡∏á

üíä ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°:
‚Ä¢ @‡∏ä‡∏∑‡πà‡∏≠ ‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤‡πÅ‡∏•‡πâ‡∏ß
‚Ä¢ @‡∏ä‡∏∑‡πà‡∏≠ ‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô 120/80
‚Ä¢ @‡∏ä‡∏∑‡πà‡∏≠ ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏î‡∏µ

üÜò ‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô:
‚Ä¢ ‡∏ä‡πà‡∏ß‡∏¢‡∏î‡πà‡∏ß‡∏ô - ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô
‚Ä¢ ‡πÇ‡∏ó‡∏£‡∏´‡∏°‡∏≠ - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô`;
```

---

## Step 7: Best Practices ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Group Bot

### 7.1 ‡∏•‡∏î Spam
```javascript
// ‡∏£‡∏ß‡∏° notification ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
const batchNotifications = async (notifications) => {
  if (notifications.length === 1) {
    return notifications[0];
  }
  
  return {
    type: 'text',
    text: notifications.map((n, i) => `${i+1}. ${n}`).join('\n')
  };
};
```

### 7.2 Time-based Quiet Mode
```javascript
// ‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á 22:00 - 07:00 (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô)
const shouldSendMessage = (priority = 'normal') => {
  const hour = new Date().getHours();
  
  if (priority === 'emergency') return true;
  if (hour >= 22 || hour < 7) return false;
  
  return true;
};
```

### 7.3 Personalized Mention
```javascript
// ‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
const mentionUser = (userId, message) => {
  return {
    type: 'text',
    text: message,
    mention: {
      mentionees: [{
        index: 0,
        length: message.indexOf(' '),
        userId: userId
      }]
    }
  };
};
```

---

## Step 8: Migration Strategy (‡∏¢‡πâ‡∏≤‡∏¢‡∏à‡∏≤‡∏Å 1-1 ‡πÄ‡∏õ‡πá‡∏ô Group)

### Option 1: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô Group ‡πÄ‡∏•‡∏¢
```
1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏° LINE ‡πÉ‡∏´‡∏°‡πà
2. ‡πÄ‡∏ä‡∏¥‡∏ç‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ + ‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏≤‡∏ô + Bot
3. Setup ‡πÉ‡∏´‡∏°‡πà‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°
```

### Option 2: Hybrid Mode
```
1. ‡∏ö‡∏≠‡∏ó 1-1 ‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏ (privacy)
2. Forward summary ‡πÑ‡∏õ‡∏Å‡∏•‡∏∏‡πà‡∏° (transparency)
3. Alert ‡∏™‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á 2 ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á
```

### Option 3: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ
```javascript
// Let family choose during setup
const setupMode = await askPreference();

if (setupMode === 'group') {
  // Guide to create group
} else {
  // Individual chat mode
}
```

---

## Step 9: Example Implementation

### 9.1 Main Group Handler
```javascript
// src/services/line/groupHandler.js
class GroupHandler {
  async handleGroupEvent(event) {
    const { type, source, message } = event;
    
    if (type === 'join') {
      return this.handleJoinGroup(event);
    }
    
    if (type === 'message') {
      // Check if bot was mentioned
      if (this.isBotMentioned(message)) {
        return this.handleBotCommand(event);
      }
      
      // Check if it's a patient response
      if (this.isPatientResponse(message, source.userId)) {
        return this.handlePatientResponse(event);
      }
    }
    
    if (type === 'memberJoined') {
      return this.handleNewMember(event);
    }
  }
  
  async handleJoinGroup(event) {
    const groupId = event.source.groupId;
    
    // Save to database
    await Group.create({
      lineGroupId: groupId,
      joinedAt: new Date()
    });
    
    // Send welcome
    await this.sendWelcomeMessage(groupId);
  }
  
  async handlePatientResponse(event) {
    const { userId, groupId } = event.source;
    const text = event.message.text;
    
    // Identify who responded
    const member = await GroupMember.findOne({
      lineUserId: userId,
      groupId: groupId
    });
    
    if (!member) {
      return this.askToRegister(event.replyToken);
    }
    
    // Process response based on content
    if (text.includes('‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤‡πÅ‡∏•‡πâ‡∏ß')) {
      await this.logMedication(member, event);
    } else if (text.includes('‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô')) {
      await this.logVitals(member, text, event);
    }
    
    // Send confirmation
    await this.confirmAction(event.replyToken, member, text);
  }
}
```

---

## Step 10: Monitoring & Analytics

### 10.1 Group Activity Dashboard
```javascript
// Track metrics per group
const groupMetrics = {
  groupId: 'Cxxxxx',
  totalMembers: 5,
  elderlyCount: 2,
  todayResponses: 4,
  complianceRate: 80,
  lastActivity: new Date()
};
```

### 10.2 Alert if Group Inactive
```javascript
// Check daily
async function checkGroupActivity() {
  const inactiveGroups = await Group.findAll({
    where: {
      lastActivity: {
        [Op.lt]: moment().subtract(3, 'days')
      }
    }
  });
  
  for (const group of inactiveGroups) {
    await sendReactivationMessage(group.lineGroupId);
  }
}
```

---

## üìä Pros & Cons Summary

### ‡πÉ‡∏ä‡πâ Bot ‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° ‡πÄ‡∏°‡∏∑‡πà‡∏≠:
‚úÖ ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡πÉ‡∏Å‡∏•‡πâ‡∏ä‡∏¥‡∏î ‡πÑ‡∏°‡πà‡∏Å‡∏±‡∏á‡∏ß‡∏•‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á privacy
‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏£‡πà‡∏ß‡∏°
‚úÖ ‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡∏™‡∏±‡∏ö‡∏™‡∏ô‡∏á‡πà‡∏≤‡∏¢ (‡πÉ‡∏ä‡πâ‡πÅ‡∏Ñ‡πà‡πÅ‡∏≠‡∏õ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)

### ‡πÉ‡∏ä‡πâ Bot ‡πÅ‡∏ö‡∏ö 1-1 ‡πÄ‡∏°‡∏∑‡πà‡∏≠:
‚úÖ ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ privacy ‡∏™‡∏π‡∏á
‚úÖ ‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
‚úÖ ‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏≤‡∏Å spam ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß

### Hybrid Mode (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥):
‚úÖ Bot 1-1 ‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏
‚úÖ Daily Report ‡∏™‡πà‡∏á‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°
‚úÖ Emergency Alert ‡∏™‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á 2 ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á

---

*Last Updated: 2025-01-03*
*For: Health Buddy MVP - Group Mode*