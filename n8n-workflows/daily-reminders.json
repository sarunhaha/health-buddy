{
  "name": "Daily Reminders",
  "nodes": [
    {
      "id": "morningCron",
      "type": "n8n-nodes-base.cron",
      "position": [250, 200],
      "parameters": {
        "triggerTimes": {
          "item": [{
            "hour": 8,
            "minute": 0
          }]
        }
      }
    },
    {
      "id": "noonCron",
      "type": "n8n-nodes-base.cron",
      "position": [250, 300],
      "parameters": {
        "triggerTimes": {
          "item": [{
            "hour": 12,
            "minute": 0
          }]
        }
      }
    },
    {
      "id": "eveningCron",
      "type": "n8n-nodes-base.cron",
      "position": [250, 400],
      "parameters": {
        "triggerTimes": {
          "item": [{
            "hour": 18,
            "minute": 0
          }]
        }
      }
    },
    {
      "id": "getActiveUsers",
      "type": "n8n-nodes-base.supabase",
      "position": [450, 300],
      "parameters": {
        "operation": "getAll",
        "table": "users",
        "filters": {
          "conditions": [{
            "field": "opt_in",
            "value": true
          }]
        }
      }
    },
    {
      "id": "sendReminder",
      "type": "n8n-nodes-base.httpRequest",
      "position": [650, 300],
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/push",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [{
            "name": "Authorization",
            "value": "Bearer {{$env.LINE_CHANNEL_ACCESS_TOKEN}}"
          }]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "to",
              "value": "={{$json.line_user_id}}"
            },
            {
              "name": "messages",
              "value": "[{\"type\":\"text\",\"text\":\"üîî ‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞ ‡∏Ñ‡∏∏‡∏ì{{$json.display_name}}\\n‡∏Å‡∏î ‚úÖ ‡∏ñ‡πâ‡∏≤‡∏ó‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏´‡∏£‡∏∑‡∏≠ ‚è∞ ‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡∏ó‡∏≤‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á\",\"quickReply\":{\"items\":[{\"type\":\"action\",\"action\":{\"type\":\"message\",\"label\":\"‚úÖ ‡∏ó‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß\",\"text\":\"‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤‡πÅ‡∏•‡πâ‡∏ß\"}},{\"type\":\"action\",\"action\":{\"type\":\"message\",\"label\":\"‚è∞ ‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô\",\"text\":\"‡∏Ç‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏ó‡∏≤‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á\"}}]}}]"
            }
          ]
        }
      }
    },
    {
      "id": "logReminder",
      "type": "n8n-nodes-base.supabase",
      "position": [850, 300],
      "parameters": {
        "operation": "insert",
        "table": "reminder_logs",
        "columns": "user_id,type,sent_at",
        "values": "={{$json.id}},medication,={{new Date().toISOString()}}"
      }
    }
  ],
  "connections": {
    "morningCron": {
      "main": [["getActiveUsers"]]
    },
    "noonCron": {
      "main": [["getActiveUsers"]]
    },
    "eveningCron": {
      "main": [["getActiveUsers"]]
    },
    "getActiveUsers": {
      "main": [["sendReminder"]]
    },
    "sendReminder": {
      "main": [["logReminder"]]
    }
  }
}